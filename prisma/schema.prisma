generator client {
  provider      = "prisma-client-js"
  output        = "../node_modules/.prisma/client"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Equipment {
  id               String             @id
  userId           String
  name             String
  type             EquipmentType
  manufacturer     String?
  model            String?
  notes            String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  User             User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  FindingEquipment FindingEquipment[]

  @@index([type])
  @@index([userId])
}

model FavoriteLocation {
  id        String   @id
  userId    String
  name      String
  latitude  Float
  longitude Float
  notes     String?
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model FeatureRequest {
  id          String        @id
  userId      String
  title       String
  description String
  status      FeatureStatus @default(NEW)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  category    String        @default("Ostatn√≠")
  User        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  FeatureVote FeatureVote[]

  @@index([category])
  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model FeatureVote {
  id             String         @id
  userId         String
  featureId      String
  createdAt      DateTime       @default(now())
  FeatureRequest FeatureRequest @relation(fields: [featureId], references: [id], onDelete: Cascade)
  User           User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, featureId])
  @@index([featureId])
  @@index([userId])
}

model Finding {
  id                String             @id
  userId            String
  title             String
  latitude          Float
  longitude         Float
  date              DateTime
  description       String
  category          String
  condition         String?
  depth             Float?
  locationName      String?
  historicalContext String?
  material          String?
  isPublic          Boolean            @default(false)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  User              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  FindingEquipment  FindingEquipment[]
  FindingImage      FindingImage[]

  @@index([category])
  @@index([date])
  @@index([isPublic])
  @@index([userId])
}

model FindingEquipment {
  id          String    @id
  findingId   String
  equipmentId String
  createdAt   DateTime  @default(now())
  Equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  Finding     Finding   @relation(fields: [findingId], references: [id], onDelete: Cascade)

  @@unique([findingId, equipmentId])
  @@index([equipmentId])
  @@index([findingId])
}

model FindingImage {
  id           String   @id
  findingId    String
  originalUrl  String
  thumbnailUrl String
  mediumUrl    String
  order        Int      @default(0)
  filename     String
  filesize     Int
  createdAt    DateTime @default(now())
  Finding      Finding  @relation(fields: [findingId], references: [id], onDelete: Cascade)

  @@index([findingId])
  @@index([findingId, order])
}

model SocialLink {
  id        String   @id
  userId    String
  platform  String
  url       String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model MapSetup {
  id        String   @id @default(cuid())
  userId    String
  name      String
  config    Json
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model User {
  id               String             @id
  email            String             @unique
  nickname         String?
  bio              String?
  avatarUrl        String?
  location         String?
  contact          String?
  experience       String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  Equipment        Equipment[]
  FavoriteLocation FavoriteLocation[]
  FeatureRequest   FeatureRequest[]
  FeatureVote      FeatureVote[]
  Finding          Finding[]
  MapSetup         MapSetup[]
  SocialLink       SocialLink[]

  @@index([email])
}

enum EquipmentType {
  DETECTOR
  GPS
  OTHER
}

enum FeatureStatus {
  NEW
  PLANNED
  IN_PROGRESS
  DONE
}
